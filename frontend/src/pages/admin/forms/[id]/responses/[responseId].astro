---
import AdminLayout from '../../../../../layouts/AdminLayout.astro';
import ProtectedRoute from '../../../../../components/auth/ProtectedRoute';
import ResponseDetail from '../../../../../components/forms/ResponseDetail';
import { formService } from '../../../../../lib/formService';
import { analyticsService } from '../../../../../lib/analyticsService';

export const prerender = false;

const { id, responseId } = Astro.params;

if (!id || !responseId) {
  return Astro.redirect('/admin');
}

// Intentar obtener información básica del formulario
let formTitle = 'Formulario';

try {
  const form = await formService.getFormById(id);
  formTitle = form.title;
} catch (err) {
  console.error('Error al cargar información del formulario:', err);
}
---

<AdminLayout title={`Detalle de Respuesta - ${formTitle}`} currentPath="/admin">
  <ProtectedRoute client:load>
    <div class="max-w-7xl mx-auto">
      <!-- Header -->
      <div class="mb-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-2xl font-bold text-gray-900">Detalle de Respuesta</h1>
            <p class="text-gray-600 mt-1">Visualización completa de la respuesta</p>
          </div>
          <a
            href={`/admin/forms/${id}/responses`}
            class="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition"
          >
            ← Volver a Respuestas
          </a>
        </div>
      </div>

      <!-- Contenido -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <ResponseDetail formId={id} responseId={responseId} client:load />
      </div>
    </div>
  </ProtectedRoute>
</AdminLayout>
